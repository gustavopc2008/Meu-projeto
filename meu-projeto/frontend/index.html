<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé∂ R√°dio da Escola</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#a34621,#191414);
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
  min-height:100vh;
}
h1 { font-size:1.8rem; margin-bottom:20px; text-align:center; }
.card { background:#222; padding:15px; border-radius:12px; width:100%; max-width:320px; box-shadow:0 2px 12px rgba(0,0,0,0.4);}
input,button { width:100%; padding:4px; margin:8px 0px; border:none; border-radius:8px; font-size:1rem;}
input { background:#333; color:#fff;}
button { background:#a34621; color:#fff; font-weight:bold; cursor:pointer;}
button:hover { background:#a34621;}
.results { margin-top:20px; }
.track { background:#333; padding:12px; border-radius:8px; margin-bottom:12px; }
.track h3 { margin:0; font-size:1rem; }
.track p { margin:4px 0; font-size:0.9rem; color:#aaa; }
iframe { margin-top:8px; width:100%; height:150px; border-radius:8px; }
</style>
</head>
<body>
<h1>üìª R√°dio da Escola</h1>
<div class="card">
  <input id="nomePessoa" type="text" placeholder="Digite seu nome">
  <input id="musica" type="text" placeholder="Digite o nome da m√∫sica">
  <button onclick="buscarMusica()">üîç Buscar M√∫sica</button>
  <div class="results" id="results"></div>
</div>

<script>
async function buscarMusica() {
  const nomePessoa = document.getElementById('nomePessoa').value.trim();
  const musica = document.getElementById('musica').value.trim();
  const resultsDiv = document.getElementById('results');

  if (!nomePessoa || !musica) return alert("Preencha seu nome e a m√∫sica.");
  resultsDiv.innerHTML = "<p>üîé Buscando m√∫sicas...</p>";

  try {
    const response = await fetch(`/search?q=${encodeURIComponent(musica)}`);
    const data = await response.json();

    if(!data.items || !data.items.length) {
      resultsDiv.innerHTML = "<p>‚ö†Ô∏è Nenhum resultado encontrado.</p>";
      return;
    }

    resultsDiv.innerHTML = `<h2>Resultados para ${nomePessoa} üé∂</h2>`;
    data.items.forEach(item => {
      const videoId = item.id.videoId;
      const title = item.snippet.title;
      const channel = item.snippet.channelTitle;

      resultsDiv.innerHTML += `
        <div class="track">
          <h3>${title}</h3>
          <p>${channel}</p>
          <iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>
          <button onclick="enviarSugestao('${title}','${channel}','${videoId}')">‚úÖ Enviar sugest√£o</button>
        </div>
      `;
    });

  } catch(error) {
    resultsDiv.innerHTML = "<p>‚ùå Erro ao buscar m√∫sicas.</p>";
    console.error(error);
  }
}

async function enviarSugestao(musica, canal, videoId){
  const nomePessoa = document.getElementById('nomePessoa').value.trim();
  if(!nomePessoa) return alert("Digite seu nome!");

  // Criar aviso na tela
  const avisoDiv = document.createElement("div");
  avisoDiv.id = "avisoEnvio";
  avisoDiv.style.position = "fixed";
  avisoDiv.style.top = "0";
  avisoDiv.style.left = "0";
  avisoDiv.style.right = "0";
  avisoDiv.style.bottom = "0";
  avisoDiv.style.background = "rgba(0,0,0,0.95)";
  avisoDiv.style.display = "flex";
  avisoDiv.style.flexDirection = "column";
  avisoDiv.style.justifyContent = "center";
  avisoDiv.style.alignItems = "center";
  avisoDiv.style.color = "#fff";
  avisoDiv.style.textAlign = "center";
  avisoDiv.style.padding = "20px";
  avisoDiv.style.zIndex = "2000";

  avisoDiv.innerHTML = `
    <h2>‚ö†Ô∏è Regras para pedir m√∫sica</h2>
    <p>‚ùå N√£o pode m√∫sicas com palavr√µes</p>
    <p>‚ùå N√£o pode m√∫sicas com conte√∫do impr√≥prio</p>
    <p>‚ùå N√£o pode m√∫sicas ofensivas</p>
    <p>‚úÖ Pe√ßa m√∫sicas legais para todos curtirem!</p>
    <button id="btnConfirmar" disabled>Concordo (15)</button>
  `;

  document.body.appendChild(avisoDiv);

  // Timer para liberar o bot√£o
  let segundos = 15;
  const btnConfirmar = document.getElementById("btnConfirmar");
  const timer = setInterval(() => {
    segundos--;
    btnConfirmar.innerText = `Concordo (${segundos})`;
    if (segundos <= 0) {
      clearInterval(timer);
      btnConfirmar.innerText = "‚úÖ Concordo";
      btnConfirmar.disabled = false;
    }
  }, 1000);

  // Quando confirmar, envia a sugest√£o de verdade
  btnConfirmar.addEventListener("click", async () => {
    avisoDiv.remove(); // fecha aviso

    const link = `https://www.youtube.com/watch?v=${videoId}`;

    const response = await fetch("/suggest", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({nome:nomePessoa,musica,canal,link})
    });

    const data = await response.json();
    if(data.success) alert("‚úÖ Sugest√£o enviada!");
    else alert("‚ùå Erro ao enviar sugest√£o");
  });
}
</script>
</body>
</html>
